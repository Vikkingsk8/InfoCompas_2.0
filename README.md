# ИнфоКомпас: Виртуальный помощник на основе TF-IDF и NLP

## Описание проекта

ИнфоКомпас — это виртуальный помощник, разработанный для помощи пользователям в поиске информации из различных источников, таких как Excel-таблицы и PDF-документы, с использованием методов NLP (Natural Language Processing) и TF-IDF (Term Frequency-Inverse Document Frequency) для анализа текста и поиска наиболее релевантных ответов.

## Основные компоненты и функциональность

### 1. Загрузка и обработка данных

#### 1.1. Загрузка данных из Excel
Функция `load_excel_data(path)` загружает данные из Excel-файла, который содержит вопросы и ответы. Эти данные используются для поиска ответов на основе введенных пользователем вопросов.

#### 1.2. Загрузка данных из файла links.xlsx
Функция `load_excel_data(path)` также загружает данные из файла `links.xlsx`, который содержит вопросы и связанные с ними ссылки. Эти данные используются для предоставления пользователю дополнительных ресурсов, связанных с их запросом.

### 2. Обработка текста

#### 2.1. Получение эмбеддингов
Функция `get_embedding(text)` использует модель `AutoModel` из библиотеки `transformers` для получения эмбеддингов текста. Эти эмбеддинги используются для вычисления сходства между введенными пользователем вопросами и текстом в документах.

#### 2.2. Создание TF-IDF матрицы
Функция `find_relevant_links(user_question, threshold)` создает TF-IDF матрицу на основе вопросов из файла `links.xlsx`. Эта матрица используется для вычисления сходства между введенными пользователем вопросами и вопросами в файле `links.xlsx`.

### 3. Поиск ответов

#### 3.1. Поиск наилучшего ответа
Функция `find_most_similar_question(query_embedding, df)` находит наиболее релевантный ответ на основе введенного пользователем вопроса, используя эмбеддинги и DataFrame с вопросами и ответами.

#### 3.2. Предварительная обработка и форматирование ответа
Функция `preprocess_excel_data(df, column_name)` предварительно обрабатывает данные из Excel, разделяя текст вопросов на отдельные вопросы и приводя их к нижнему регистру.

### 4. Обработка вопросов и ссылок

#### 4.1. Предварительная обработка текста
Функция `preprocess_excel_data(df, column_name)` обрабатывает текст вопросов, приводя его к нижнему регистру и удаляя лишние пробелы.

#### 4.2. Поиск релевантных ссылок
Функция `find_relevant_links(user_question, threshold)` находит релевантные ссылки на основе введенного пользователем вопроса и порогового значения сходства.

### 5. Функциональность кнопок ссылок

#### 5.1. Отправка вопроса и открытие ссылки
При нажатии на кнопку ссылки, вопрос, связанный с этой ссылкой, отправляется на сервер для поиска ответа, и ссылка открывается в новом окне. Это позволяет пользователю получить дополнительную информацию, связанную с их запросом.

### 6. Автоматическое переобучение модели

#### 6.1. Сохранение и загрузка данных о лайках и дизлайках
Функция `save_feedback(question, feedback)` сохраняет данные о лайках и дизлайках в CSV-файл. Функция `load_feedback()` загружает эти данные для дальнейшего использования.

#### 6.2. Переобучение модели
Функция `retrain_model()` загружает данные обратной связи из CSV-файла, обрабатывает их и может использоваться для переобучения модели на основе этих данных.

### 7. Маршруты и эндпоинты

#### 7.1. Главная страница
Маршрут `/` отвечает за отображение главной страницы с интерфейсом для ввода вопросов.

#### 7.2. Эндпоинт для чата
Маршрут `/chat` обрабатывает POST-запросы с вопросами от пользователей и возвращает наиболее релевантный ответ.

#### 7.3. Эндпоинт для загрузки PDF
Маршрут `/download_pdf` позволяет пользователям скачать PDF-документ.

#### 7.4. Эндпоинт для обратной связи
Маршрут `/feedback` обрабатывает POST-запросы с данными о лайках и дизлайках от пользователей.

## Установка
Для установки и запуска ИнфоКомпас, следуйте этим простым шагам:

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Vikkingsk8/InfoCompas_2.0.git
   cd InfoCompas_2.0
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Запустите приложение:
   ```bash
   python app.py
   ```

## Использование

Откройте ваш любимый браузер и перейдите по адресу http://127.0.0.1:5000/.

Введите ваш вопрос в поле ввода и нажмите кнопку "Отправить".

### Примечание к использованию
Если вы обновили данные в файлах Excel или PDF, не забудьте перезапустить приложение, так как ИнфоКомпас использует механизм кэширования для улучшения производительности.

## Тестирование
Для запуска тестов используйте следующую команду:

```bash
python -m unittest test_app.py
```

### Тесты для маршрутов
- `test_index_page`: Проверяет, что главная страница возвращает статус-код 200.
- `test_download_pdf`: Проверяет корректность работы маршрута для скачивания PDF-файла.
- `test_chat_endpoint`: Проверяет корректность обработки запроса к чат-боту.
- `test_load_suggestions`: Проверяет, что эндпоинт `/load_suggestions` возвращает список предложений.
- `test_chat_endpoint_with_short_question`: Проверяет обработку некорректного ввода пользователя.
- `test_chat_endpoint_with_relevant_links`: Проверяет, что эндпоинт `/chat` возвращает релевантные ссылки.

## Структура проекта
```
Infokompas/
├── app.py
├── .gitattributes
├── requirements.txt
├── LICENSE.md
├── README.md
├── test_app.py
├── model/
│   ├── config.json
│   ├── model.safetensors
│   ├── special_tokens_map.json
│   ├── tokenizer.json
│   ├── tokenizer_config.json
│   └── vocab.txt
├── data/
│   ├── ответы.xlsx
│   ├── links.xlsx
│   └── instruction.pdf
├── static/
│   ├── styles.css
│   ├── background.jpg
│   ├── bot_icon.png
│   ├── image.png
│   └── user_icon.png
└── templates/
    └── index.html
```

## Заключение

ИнфоКомпас — это мощный инструмент для поиска информации, который использует современные методы обработки текста и машинного обучения для предоставления пользователям наиболее релевантных ответов и ссылок. Благодаря автоматическому переобучению и интеграции с различными источниками данных, ИнфоКомпас обеспечивает высокую точность и эффективность в работе.

## Авторы

- Ермилов В.В. (разработчик)
- Файбисович В.А. (аналитик)